<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}AI手紙アプリ{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/common.css') }}">
</head>
<body>
    {% block content %}{% endblock %}

    <!-- 🔊 BGMコントロール -->
    <div id="bgm-controls" style="position: fixed; bottom: 10px; left: 10px; background: rgba(0,0,0,0.5); color: white; padding: 8px; border-radius: 10px;">
        🎵 <select id="musicSelect">
            <option value="/static/sound/bgm.mp3">通常BGM</option>
            <option value="/static/sound/sea.mp3">海の音</option>
            <option value="/static/sound/forest.mp3">森の音</option>
        </select>
        🔈<input type="range" id="volume" min="0" max="1" step="0.01" value="0.3">
    </div>

    <script>
        // BGM専用ウィンドウを開く
        if (!window.bgmWindow || window.bgmWindow.closed) {
            window.bgmWindow = window.open("/bgm", "bgmWindow", "width=1,height=1");
        }

        const volumeSlider = document.getElementById("volume");
        const musicSelect = document.getElementById("musicSelect");

        // 初期音量
        function sendToBgm(data){
            if(window.bgmWindow){
                window.bgmWindow.postMessage(data, "*");
            }
        }

        window.onload = () => {
            sendToBgm({type: "setVolume", value: volumeSlider.value});
            sendToBgm({type: "setMusic", value: musicSelect.value});
        };

        volumeSlider.addEventListener("input", () => {
            sendToBgm({type: "setVolume", value: volumeSlider.value});
        });

        musicSelect.addEventListener("change", () => {
            sendToBgm({type: "setMusic", value: musicSelect.value});
        });
    </script>
</body>
</html>